<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Library Management System</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,200..1000;1,200..1000&display=swap"
      rel="stylesheet" />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Library Management System</h1>
    <div class="app">
      <section id="add-book">
        <h2>Add New Book</h2>
        <form id="new-book-form">
          <div class="form-group">
            <label for="book-title">Book Title</label>
            <input
              type="text"
              id="book-title"
              placeholder="Enter book title"
              required />
          </div>

          <div class="form-group">
            <label for="book-author">Author</label>
            <input
              type="text"
              id="book-author"
              placeholder="Enter author name"
              required />
          </div>

          <div class="form-group">
            <label for="book-category">Category</label>
            <select id="book-category" required>
              <option value="" selected disabled>Select a category</option>
              <option value="fantasy">Fantasy</option>
              <option value="romance">Romance</option>
              <option value="science-fiction">Science Fiction</option>
              <option value="thriller">Thriller/Mystery/Crime</option>
              <option value="self-help">Self-Help</option>
              <option value="children">Children's Literature</option>
              <option value="history">History</option>
              <option value="poetry">Poetry</option>
            </select>
          </div>

          <div class="form-group">
            <label for="is-reference" class="checkbox-label">
              <input type="checkbox" id="is-reference" /> Is a Reference Book?
            </label>
          </div>
          <div
            class="form-group"
            id="location-code-container"
            style="display: none">
            <label for="location-code">Location Code</label>
            <input
              type="text"
              id="location-code"
              placeholder="Enter location code" />
          </div>

          <button type="submit" class="btn">Add Book</button>
        </form>
      </section>

      <section id="searchFilter">
        <div class="search-filter">
          <div class="search-box">
            üîç
            <input
              id="search-text"
              type="text"
              placeholder="search for a book by name or author" />
          </div>
          <div class="filter">
            <select name="category-filter" id="category-filter">
              <option value="all">All Categories</option>
              <option value="fantasy">Fantasy</option>
              <option value="romance">Romance</option>
              <option value="science-fiction">Science Fiction</option>
              <option value="thriller">Thriller/Mystery/Crime</option>
              <option value="self-help">Self-Help</option>
              <option value="children">Children's Literature</option>
              <option value="history">History</option>
              <option value="poetry">Poetry</option>
            </select>
          </div>
        </div>
      </section>

      <section id="booksList">
        <div class="container">
          <div class="books-list" id="books-list"></div>
        </div>
      </section>
    </div>
    <script>
      class Book {
        #id;
        #title;
        #author;
        #category;
        #isAvailable;

        constructor(title, author, category) {
          this.#id = Date.now();
          this.#title = title;
          this.#author = author;
          this.#category = category;
          this.#isAvailable = true;
        }

        setAvailability(availability) {
          this.#isAvailable = availability;
        }
        getAvailability() {
          return this.#isAvailable;
        }

        getTitle() {
          return this.#title;
        }

        getAuthor() {
          return this.#author;
        }

        getCategory() {
          return this.#category;
        }

        getId() {
          return this.#id;
        }

        toggleAvailability() {
          this.#isAvailable = !this.#isAvailable;
          return this.#isAvailable;
        }

        displayInfo() {
          return `Title: ${this.#title}<br>Author: ${
            this.#author
          }<br>Category: ${this.#category}`;
        }
      }

      class ReferenceBook extends Book {
        #locationCode;

        constructor(title, author, category, locationCode) {
          super(title, author, category);
          this.#locationCode = locationCode;
        }

        getLocationCode() {
          return this.#locationCode;
        }

        displayInfo() {
          const parentInfo = super.displayInfo();
          return `${parentInfo}<br>Location Code: ${this.#locationCode}`;
        }
      }

      class Library {
        #books = [];

        addBook(book) {
          this.#books.push(book);
        }

        getBooks() {
          return this.#books;
        }

        removeBook(id) {
          this.#books = this.#books.filter(
            (book) => book.getId() !== Number(id)
          );
        }

        toggleAvailability(id) {
          const book = this.#books.find((book) => book.getId() === Number(id));
          if (book) {
            book.toggleAvailability();
          }
        }

        searchBooks(input) {
          return this.#books.filter((book) => {
            const lowerInput = input.toLowerCase();
            return (
              book.getTitle().toLowerCase().includes(lowerInput) ||
              book.getAuthor().toLowerCase().includes(lowerInput)
            );
          });
        }

        filterByCategory(category) {
          if (category === "all") {
            return this.#books;
          }
          return this.#books.filter((book) => {
            return book.getCategory() === category;
          });
        }
      }

      const booksLibrary = new Library();

      const searchInput = document.getElementById("search-text");
      const categoryFilter = document.getElementById("category-filter");
      const booksList = document.getElementById("books-list");
      const addBookForm = document.getElementById("new-book-form");
      const newTitleInput = document.getElementById("book-title");
      const newAuthorInput = document.getElementById("book-author");
      const newCategorySelect = document.getElementById("book-category");
      const isReferenceCheckbox = document.getElementById("is-reference");
      const locationCodeInput = document.getElementById("location-code");
      const locationCodeContainer = document.getElementById(
        "location-code-container"
      );

      function renderBooks(books) {
        booksList.innerHTML = "";

        if (books.length === 0) {
          booksList.innerHTML = `
            <div class="no-results">
              <p>No books found to show.</p>
              </div>
              `;
          return;
        }

        books.forEach((book) => {
          const bookCard = document.createElement("div");
          const availabilityStatus = book.getAvailability()
            ? "Available"
            : "Unavailable";
          const statusClass = book.getAvailability()
            ? "available"
            : "unavailable";

          bookCard.className = "book-card";
          bookCard.dataset.id = book.getId();
          bookCard.innerHTML = `
              <button class="delete-book-icon">üóëÔ∏è</button>
              <div class="book-cover">BOOK</div>
              <div class="book-info">
                <div class="book-title">${book.getTitle()}</div>
                <div class="book-author">By ${book.getAuthor()}</div>
                <div class="book-category">${book.getCategory()}</div>
                ${
                  book instanceof ReferenceBook
                    ? `<div class="location-code">Location: ${book.getLocationCode()}</div>`
                    : ""
                }
                <div class="availability">
                  <span class="status ${statusClass}">${availabilityStatus}</span>
                  <button class="toggle-btn">${
                    book.getAvailability() ? "Borrow" : "Return"
                  }</button>
                </div>
              </div>
          `;

          booksList.appendChild(bookCard);
        });
        addEventListnersToCards();
      }

      function addEventListnersToCards() {
        document.querySelectorAll(".toggle-btn").forEach((button) => {
          button.addEventListener("click", (event) => {
            const bookCard = event.target.closest("[data-id]");
            const bookId = bookCard.dataset.id;
            booksLibrary.toggleAvailability(bookId);
            filterAndRenderBooks();
          });
        });

        document.querySelectorAll(".delete-book-icon").forEach((button) => {
          button.addEventListener("click", (event) => {
            const bookCard = event.target.closest("[data-id]");
            const bookId = bookCard.dataset.id;
            booksLibrary.removeBook(bookId);
            filterAndRenderBooks();
          });
        });
      }

      function filterAndRenderBooks() {
        const searchInputValue = searchInput.value.toLowerCase();
        const categoryFilterValue = categoryFilter.value;

        let filteredBooks = booksLibrary.getBooks();

        if (searchInputValue) {
          filteredBooks = filteredBooks.filter((book) => {
            const lowerInput = searchInputValue.toLowerCase();
            return (
              book.getTitle().toLowerCase().includes(lowerInput) ||
              book.getAuthor().toLowerCase().includes(lowerInput)
            );
          });
        }

        if (categoryFilterValue !== "all") {
          filteredBooks = filteredBooks.filter(
            (book) => book.getCategory() === categoryFilterValue
          );
        }

        renderBooks(filteredBooks);
      }

      searchInput.addEventListener("input", filterAndRenderBooks);
      categoryFilter.addEventListener("change", filterAndRenderBooks);

      addBookForm.addEventListener("submit", (event) => {
        event.preventDefault();

        const title = newTitleInput.value.trim();
        const author = newAuthorInput.value.trim();
        const category = newCategorySelect.value;
        const isReference = isReferenceCheckbox.checked;

        if (title && author && category) {
          if (isReference) {
            const locationCode = locationCodeInput.value.trim();
            if (locationCode) {
              booksLibrary.addBook(
                new ReferenceBook(title, author, category, locationCode)
              );
            } else {
              console.error("Location code is required for reference books.");
              return;
            }
          } else {
            booksLibrary.addBook(new Book(title, author, category));
          }

          addBookForm.reset();

          filterAndRenderBooks();
        } else {
          console.error("Title, author, and category are required.");
        }
      });

      isReferenceCheckbox.addEventListener("change", () => {
        if (isReferenceCheckbox.checked) {
          locationCodeContainer.style.display = "block";
          locationCodeInput.setAttribute("required", "required");
        } else {
          locationCodeContainer.style.display = "none";
          locationCodeInput.removeAttribute("required");
          locationCodeInput.value = "";
        }
      });

      filterAndRenderBooks();
    </script>
  </body>
</html>
